---
title: vue的相关
date: 2021-07-14 
categories:
  - vue
tags:
  - vue
---
# 1. vue的data为啥是一个函数而不是对象
```js
  //原理分析：
  针对根实例对象data, data对象既可以是对象也可以是函数。
  ----------------------------------------------------
  组件实例对象data必须为函数，目的是为了防止多个组件实例对象之间共用一个data，产生数据污染。
  采用函数的形式，initData时会将其作为工厂函数都会返回全新data对象。
  --------------------------------------------------
  data为函数 (针对实例对象)，通过return 返回对象的拷贝，从而开辟一个新的空间地址，致使每个实例都有自己独立的对象，数据改变时也只是在自己的作用域改变，而实例之间是不会相互影响的。
  // vue/src/core/instance/state.js
  function initData (vm: Component) {
    var data = vm.$options.data;
    data = vm._data = typeof data === 'function'
      ? getData(data, vm)
      : data || {};
    if (!isPlainObject(data)) {
      data = {};
      process.env.NODE_ENV !== 'production' && warn(
        'data functions should return an object:\n' +
        'https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function',
        vm
      );
    }
    ...
  }
  // vue/src/core/util/options.js
   strats.data = function (
    parentVal: any,
    childVal: any,
    vm?: Component
  ): ?Function {
    if (!vm) {
      if (childVal && typeof childVal !== 'function') {
        process.env.NODE_ENV !== 'production' && warn(
          'The "data" option should be a function ' +
          'that returns a per-instance value in component ' +
          'definitions.',
          vm
        )
        return parentVal
      }
      return mergeDataOrFn(parentVal, childVal)
    }
    return mergeDataOrFn(parentVal, childVal, vm)
  }
  --------------------------------------------------
  babel编译的组件对象，会造成变量相互引用。
  我们的每一个vue文件经过babel编译，将导出的对象直接替换成了一个对象变量，然后将这个变量传入到对应的组件构造函数中
```
