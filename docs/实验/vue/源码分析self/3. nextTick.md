---
title: nextTick
date: 2021-08-02
categories:
  - vue
tags:
  - vue
---
源码位置：src/core/util/next-tick.js
本质调用微任务队列。
```js
export function nextTick (cb?: Function, ctx?: Object) {
  let _resolve;
  // 1. 有回调函数，将回调函数绑定上下文，如果没有则resolve
  callbacks.push(() => {
    if (cb) {
      try {
        cb.call(ctx)
      } catch (e) {
        handleError(e, ctx, 'nextTick')
      }
    } else if (_resolve) {
      _resolve(ctx)
    }
  })
  // 2. 将pending设置为true
  if (!pending) {
    pending = true
    timerFunc()
    // timerFunc: 优先使用微任务，再使用宏任务。主要根据不同的兼容性问题。
    // 1. 如果支持promise,则采用promise.then(callbacks)
    // 2. 如果支持MutationObserver，则new MutationObserver(flushCallbacks)
    // 3. 如果支持setImmediate，则 setImmediate(flushCallbacks)
    // 4. setTimeout(flushCallbacks, 0)
  }
  // $flow-disable-line
  if (!cb && typeof Promise !== 'undefined') {
    return new Promise(resolve => {
      _resolve = resolve
    })
  }
}
```