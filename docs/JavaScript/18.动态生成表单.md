---
title: 动态生成表单
date: 2022-01-26
permalink:
categories:

categories: 
  - JavaScript
tags: 
  - null
---

```js
<template>
  <el-form
    ref="form"
    :model="model"
    v-bind="$attrs"
    :label-width="labelWidth"
    v-loading="showLoading"
  >
    <slot></slot>
    <template v-for="item in formOptions">
      <el-form-item
        :label="item.label"
        :key="item.valueKey"
        :prop="item.valueKey"
        :error="item.error"
        :ref="item.valueKey"
      >
        <slot :name="item.valueKey">
          <component
            @clearErrorOne="clearErrorOne"
            :is="item.type === 'custom' ? null : `ID${item.type}`"
            :valueKey="item.valueKey"
            :options="item.options"
            :optionsConfig="item.optionsConfig"
            v-model="model[item.valueKey]"
            v-bind="{ ...item.elProps }"
            v-on="{ ...item.elEvents }"
          >
            <template v-if="item.type === 'select'" v-slot="selectOption">
              <slot
                :name="`${item.valueKey}Select`"
                v-bind="{ ...selectOption }"
              ></slot>
            </template>
            <template
              v-if="item.type === 'select'"
              v-slot:footer="{ toggleMenu, noData }"
            >
              <slot
                :name="`${item.valueKey}SelectFooter`"
                :toggleMenu="toggleMenu"
                :noData="noData"
              ></slot>
            </template>

           <template
              v-if="item.type === 'select'"
              v-slot:empty="{ toggleMenu }"
            >
              <slot
                :name="`${item.valueKey}SelectEmpty`"
                :toggleMenu="toggleMenu"
              ></slot>
            </template>
          </component>
        </slot>
        <slot :name="`${item.valueKey}FormItem`"></slot>
        <template v-slot:label>
          <slot :name="`${item.valueKey}Label`">
            <el-tooltip
              v-if="item.label && item.label.length > 8"
              :content="item.label"
              placement="top"
            >
              <p>{{ item.label }}</p>
            </el-tooltip>
            <span v-else>{{ item.label }}</span>
          </slot>
        </template>
      </el-form-item>
    </template>
  </el-form>
</template>

<script>
import IDinput from './id-input.vue'
import IDselect from './id-select.vue'
import IDradio from './id-radio.vue'
import IDcheckbox from './id-checkbox.vue'
import IDdateTimePicker from './id-datetime-picker.vue'
import IDinputNumber from './id-input-number.vue'
import IDswitch from './id-switch.vue'
import IDimg from './id-img.vue'
import IDtimePicker from './id-time-picker.vue'
import IDcascader from './id-cascader.vue'
import IDselectTree from './id-select-tree.vue'
import IDfile from './id-file.vue'

export default {
  name: 'idaas-form',
  components: {
    IDinput,
    IDselect,
    IDradio,
    IDcheckbox,
    IDdateTimePicker,
    IDinputNumber,
    IDswitch,
    IDimg,
    IDtimePicker,
    IDcascader,
    IDselectTree,
    IDfile,
  },
  data() {
    return {
      showLoading: false,
    }
  },
  props: {
    formOptions: {
      type: Array,
      default: () => [],
    },
    model: {
      type: Object,
      required: true,
      default: () => ({}),
    },
    labelWidth: {
      type: [Number, String],
      default: '140px',
    },
  },
  methods: {
    async validate(callback) {
      return typeof callback === 'function'
        ? this.$refs.form.validate(callback)
        : await this.$refs.form.validate()
    },
    resetFields() {
      this.$refs.form.resetFields()
    },
    clearErrorOne(key) {
      const el = this.$refs[key]
      if (el && el[0]) el[0].clearValidate()
    },
  },
  watch: {
    model: {
      immediate: true,
      handler(n) {
        this.showLoading = true
        setTimeout(() => {
          this.showLoading = false
        }, 700)
      },
    },
    formOptions: {
      immediate: true,
      handler(n) {
        this.showLoading = true
        setTimeout(() => {
          this.showLoading = false
        }, 700)
      },
    },
  },
}
</script>

<style scoped>
.el-form-item__label p.el-tooltip {
  display: inline-block;
  overflow: hidden;

  max-width: 116px;

  vertical-align: middle;
  white-space: nowrap;
  text-overflow: ellipsis;
}
</style>
```
