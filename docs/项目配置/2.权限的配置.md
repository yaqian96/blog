---
title: axios配置
date: 2021-05-13
permalink:
categories: 
  - 项目配置
tags: 
  - 项目配置
---
### 极活动
## 通过判断是否为微信浏览器，之后判断store中是否有token,没有token,跳转到登录页，有token跳转到首页。
```
export default ({ store, route, redirect, $axios, app, req }: Context) => {
  let ua = window.navigator.userAgent.toLowerCase();
  const match = ua.match(/MicroMessenger/i);
  // 通过正则表达式匹配ua中是否含有MicroMessenger字符串
  if ((match !== null && match.includes('micromessenger')) || getQueryVariable('auth') === 'geekjingjing') {
    if (route.path === '/' || /^\/login/g.test(route.path)) {
      store.commit('SET_INFO', {
        employeeId: getQueryVariable('employeeId'),
        employeeName: getQueryVariable('employeeName'),
        punchCardId: getQueryVariable('punchCardId'),
        courseName: getQueryVariable('courseName')
      });
    }
    if (!/^\/login/g.test(route.path) && (route.name !== 'member-learnReport' || (route.name === 'member-learnReport' && !route.query.share))) {
      if (!store.state.token) {
        return redirect({
          path: '/login',
          query: {
            ...route.query
          }
        })
      } else {
        attendPunchCard({
          employeeId: store.state.info.employeeId,
          employeeName: store.state.info.employeeName,
          punchCardId: store.state.info.punchCardId,
          studentName: store.state.info.name
        }).then(res => {
          if (res[0]) {
            if (route.path === '/' || !route.path) {
              return redirect({
                name: 'home'
              })
            }
          } else {
            if (route.path === '/') {
              Toast.fail(res[1].msg)
            } else {
              Toast('登录失效，即将跳转到登录页面')
            }
            setTimeout(() => {
              return redirect({
                path: '/login',
                query: {
                  ...route.query
                }
              });
            }, 3000)
          }
        });
      }
    }
    (app as any).head.title = getStorage('courseName')
  } else if (route.path.indexOf('/noweixin') === -1) {
    return redirect({
      path: '/noweixin'
    });
  }
}
```
### 极题库
## 通过前台传递的权限，经过permission函数进行配置
```
export default {
  name: "permission",
  render(createElement) {
    if (this.isShow) {
      // if (this.$scopedSlots && this.$scopedSlots.default) {
      //   return this.$scopedSlots.default({})
      // }
      if (this.$slots.default) {
        // 有权限正常返回
        return this.$slots.default[0];
      } else {
        // 权限组件中未包含控制内容
        return createElement(
          "span",
          {
            class: "no-content",
            style: { display: "none" },
          },
          []
        );
      }
    }
    // 无权限
    return createElement(
      "span",
      {
        class: "no-permission",
        style: { display: "none" },
      },
      []
    );
  },
  props: {
    keyName: {
      required: true,
      type: [String, Array],
    },
  },
  computed: {
    isShow() {
      return this.$permission(this.keyName);
      // return true
    },
  },
};
```