---
title: 内容多步骤的更新指引
date: 2021-07-20
permalink: 
categories: 
  - 组件
tags: 
  - 组件
---
```js
import intro from "intro.js";
import {getCookie, setCookie} from "@/utils/cookie";
import store from '../../store'

const employeeId = store?.state?.me?.employeeId
// 判断是否查看过intro的 cookies key
const cookiesKey = `introGuide_${employeeId}`
/**
 * 原生方法
 */
export function introJs(){
  return intro()
}
/**
 * 新功能指引组件
 * @param {Array} stepsArray 步骤配置数组
 * @param {String} uniqueKey key 用于判断是否 首次查看Intro
 * @param {Function} completeCustomCb 完成回调
 * @param {Object} introCfg 配置项
 */
export function startIntro(stepsArray=[], uniqueKey, completeCustomCb=() => {}, introCfg={}){
  // 参数检查 和 已查看过 intro 就不再弹出
  if (!paramsCheck(stepsArray, uniqueKey) || isCheckedIntro(uniqueKey)){ return }
  const steps = stepsArray.map(stp => ({
    title: stp.title || '标题',
    element: document.querySelector(stp.elementClassName),
    intro: stp.intro || '内容',
  }))
  intro().oncomplete(() => {
    introCompleteCb(uniqueKey)
    completeCustomCb && completeCustomCb()
  }).setOptions({
    // 上一步 label 已通过css 隐藏
    prevLabel: '上一步',
    // 下一步 label
    nextLabel: '下一步',
    // 完成 label
    doneLabel: '我知道了',
    // 跳过label 已通过css 隐藏
    skipLabel: '',
    // 自定义 css 名称
    tooltipClass: 'customTooltip',
    // 隐藏 进度提示图标
    showBullets: false,
    ...introCfg,
    // 是否显示 步骤number
    // showStepNumbers: true,
    steps,
  }).start();
  // start the guide
}

/**
 * 从cookies 判断是否 已经查看过 intro
 * @param {String} uniqueKey
 */
function isCheckedIntro(uniqueKey){
  return getIntroIsCheckObj()[uniqueKey]
}

/**
 *
 * @param {String} uniqueKey
 */
function introCompleteCb(uniqueKey){
  const introCheckedObj = getIntroIsCheckObj()
  // 标志为已查看
  introCheckedObj[uniqueKey] = '1'
  setCookie(cookiesKey, JSON.stringify(introCheckedObj), 3000)
}
function getIntroIsCheckObj(){
  const _key = getCookie(cookiesKey) || '{}'
  return JSON.parse(_key)
}
// 参数 check
function paramsCheck(stepsArray, completeCb, uniqueKey){
  if (!(stepsArray instanceof Array) && !stepsArray.length) {
    console.error('customIntro:', 'stepsArray not an available array')
    return
  }
  if (!employeeId) {
    console.error('customIntro:', 'empty employeeId')
    return
  }
  if (!(uniqueKey instanceof String) && uniqueKey) {
    console.error('customIntro:', 'must have an uniqueKey')
    return
  }
  return true
}
```
### 简单用法
```js
// 以employeeId为维度, uniqueKey 为凭证 来控制是否显示intro (通过cookies实现)
import {startIntro,introJs} from "@/components/intro-js";
// 唯一key 通过key判断是否 已查看过intro
const uniquekey = '' 
// 步骤配置数组
const stepArray = [
    {
        title: '第一步title',
        // 高亮元素的 className
        elementClassName: '.intro-step1',
        intro: '第一步content',
    },
    {
        title: '第二步title',
        elementClassName: '.intro-step2',
        intro: '第二步content',
    },
    {
        title: '第三步title',
        elementClassName: '.intro-step3',
        intro: '第三步content',
    },
]
// 只需传入 stepArray 和 uniqueKey
// 更多配置 参考详细配置项 或 直接 调用 introJs
startIntro(stepArray, 'tq')
// introJs().....
// startIntro(stepArray, 'tq' ,completeCustomCb, introCfg)
```