---
title: 极教研
date: 2021-7-15 15:09
permalink: 
categories: 
  - 在线编教材工具
tags: 
  - 在线编教材工具
---
# 1. top-bar
# 2. left-bar 
```js
// 组件绑定值，使用$emit传给父组件，父组件将值传递回来，显示active
```
# 3. main-view
```js
// 页面布局、页面校验码、ai校验点、空白页、开始打印的标识
<template>
  <div class="main-view-component sys-flex-column sys-items-center" id="all-pages-container" @scroll="pageScroll">
    <!--      flex布局会让分页属性失效-->
    <div @click="showTextMenu" class="middle-container">
<!--      页面布局-->
      <div v-for="(page, pageIndex) in pages" :key="pageIndex"
           :class="{'not-first-page': pageIndex && isPreview}"
           class="print-page sys-flex-column sys-flex-center">
<!--        页面校验码-->
        <div class="identification-number">{{countCode(pageIndex + 1)}}</div>
<!--        ai标识点-->
        <img class="ai-mark-img" draggable="false" style="left: 61px; top: 36px" src="./images/point.png" alt="">
        <img class="ai-mark-img" draggable="false" style="right: 61px; top: 36px" src="./images/point.png" alt="">
        <img class="ai-mark-img" draggable="false" style="left: 61px; bottom: 36px" src="./images/point.png" alt="">
        <img class="ai-mark-img" draggable="false" style="right: 61px; bottom: 36px" src="./images/point.png" alt="">
        <img @click.stop="() => {}" class="page-bg" draggable="false" v-if="page.background" :src="page.background" alt="">
        <!--          页码-->
        <div class="print-index-container" :class="{'single-page-num': page.printIndex % 2}" v-if="page.printIndex">{{page.printIndex}}</div>
        <div v-if="!isPrint" class="dashed-border"></div>
      </div>
<!--      空白页-->
      <div class="print-page print-blank-page"></div>
      <conent-render ref="conentRender" :is-print="isPrint"></conent-render>
      <!--      开始打印的标识-->
      <div v-if="renderFinish && printList.length" id="render-finish-mark" style="display: none"></div>
    </div>
    <div class="current-page-num" v-if="!isPrint">页面：{{`${currentPageNum}/${pages.length}`}}</div>
  </div>
</template>

<script>
import { mapState } from 'vuex'
import conentRender from './conent-render'
import '@/assets/font/font.scss'

export default {
  name: 'main-view',
  props: {
    isPrint: {
      type: Boolean,
      default: false
    }
  },
  components: {
    conentRender,
  },
  data() {
    return {
      renderFinish: false,
      pageData: [],
      currentPage: [],
      generator: null,
      questionNum: 0,
      currentPageNum: 1
    }
  },
  methods: {
    pageScroll (e) {
      this.currentPageNum = parseInt((e.target.scrollTop + 562) / 1124) + 1
    },
    showTextMenu (e) {
      this.$refs.conentRender.clickItem(e, {})
    },
    countCode (index) {
      let str = '00000000'
      str = str.slice(0, 7 - this.bookId.length)
      let originHomeworkId = `${this.bookId.length}${this.bookId}${str}` + (index < 10 ? `0${index}` : index)
      let originIdNum = 100 * parseInt(originHomeworkId)
      let code = 98 - (originIdNum % 97)
      code = code < 10 ? `0${code}` : `${code}`
      return `${originHomeworkId}${code}`
    }
  },
  computed: {
    bookId () {
      return this.$route.query.id
    },
    // 远程打印样式兼容
    isPreview () {
      return this.$route.query.type
    },
    ...mapState({
      printList: (state) => {
        return state.teachingMaterial.printList
      },
      pages: (state) => {
        return state.teachingMaterial.pages
      },
      activeItem: (state) => {
        return state.teachingMaterial.activeItem
      },
      activeIndex: (state) => {
        return state.teachingMaterial.activeIndex
      }
    })
  },
  watch: {
    printList: {
      handler (N) {
        if (N && N.length) {
          setTimeout(() => {
            // 延时10秒用以图片加载
            this.renderFinish = true
          }, 10000)
        } else {
          this.renderFinish = false
        }
      },
      immediate: true,
      deep: true
    }
  },
  mounted () {
    // this.getQuestions()
  }
}
</script>
```
```js  
//content-render.vue
<template>
  <div class="print-content">
    <div style="opacity: 0" class="print-page sys-flex-column sys-flex-center">
      <div id="editor-count-body">
        <div class="question-content" :id="`${renderItem.uid}-count`">
          <div class="question-html-container" v-html="renderItem.content"></div>
        </div>
      </div>
    </div>
    <div v-for="(question, itemIndex) in printList"
         :key="`${question.id}-${itemIndex}`"
         :id="question.uid"
         :class="{active: activeItem.id === question.id && !isPrint}"
         :style="questionStyle(question)"
         @input="(e) => htmlChange(e, question)"
         @click.stop="(e) => clickItem(e, question, itemIndex)"
         class="question-content">
      <oprate-bar @click="oprateClick" v-if="activeItem.uid === question.uid && !isPrint"/>
      <!--            判题识别区-->
      <correctMark v-if="question.marks && question.marks.length" :isPrint="isPrint" :question="question"></correctMark>
      <!--            题目范围识别区-->
      <locationMark v-if="question.location" :question="question"></locationMark>
      <div :style="isPrint ? {maxHeight: `${question.height - 15}px`} : {}"
           :contenteditable="!isPrint"
           class="question-html-container"
           :class="{'edit-container': !isPrint}"
           v-html="question.content">
      </div>
      <i v-if="question.turnPage && !isPrint" style="color: #cccccc" class="turn-page-mark iconfont icon-falling"></i>
    </div>
  </div>
</template>

<script>
import { mapState } from 'vuex'
import correctMark from '@/views/teaching-material/editer/correct-mark'
import oprateBar from '@/views/teaching-material/editer/tools/oprate-bar'
import locationMark from '@/views/teaching-material/editer/location-mark'

export default {
  name: 'index',
  props: {
    isPrint: {
      type: Boolean,
      default: false
    }
  },
  components: {
    correctMark,
    oprateBar,
    locationMark
  },
  methods: {
    questionStyle (item) {
      if (this.remotePrint && item.pageIndex) {
        return {
          top: `${item.pageIndex * 1100 + item.pageTop}px`
        }
      }
      return {
        top: `${item.pageIndex * 1120 + item.pageTop}px`
      }
    },
    clickItem (e, item) {
      console.log(item)
      // 打印场景不反应
      if (this.isPrint) return
      this.$store.commit('teachingMaterial/setActiveItem', item)
      if (e.target.tagName === 'IMG') {
        this.$store.commit('teachingMaterial/imgActive', e.target)
      } else {
        this.$store.commit('teachingMaterial/imgActive', null)
      }
    },
    htmlChange (e, item) {
      setTimeout(() => {
        this.$store.commit('teachingMaterial/updateItem', {
          ...item,
          // 不更新content，避免页面渲染丢失回退信息
          backupContent: e.target.innerHTML,
          height: e.target.clientHeight
        })
      }, 100)
    },
    oprateClick (type) {
      switch (type) {
        case 'add':
          let { marks } = this.printList[this.activeIndex]
          marks.push({
            id: new Date().getTime(),
            height: this.activeItem.height - 2,
            width: 100,
            top: 0,
            left: 0})
          this.$store.commit('teachingMaterial/updateItem', {
            ...this.activeItem,
            marks
          })
          break;
        case 'remove':
          this.$confirm(
            `确认将该内容从文档中移除？`,
            "提示", {
              confirmButtonText: "确认",
              cancelButtonText: "取消",
              type: "warning",
            }
          ).then(res => {
            this.$store.commit('teachingMaterial/removeItem', this.activeItem)
          })
          break;
        case 'up':
          this.printList.forEach((item, index) => {
            if (item.uid === this.activeItem.uid && index) {
              this.$store.commit('teachingMaterial/removeItem', this.activeItem)
              setTimeout(() => {
                this.activeItem.content = this.activeItem.backupContent || this.activeItem.content
                this.$store.commit('teachingMaterial/addItem', {item: this.activeItem, index: index - 1})
              }, 10)
            } else {
              console.log('top')
            }
          })
          break;
        case 'down':
          this.printList.forEach((item, index) => {
            if (item.uid === this.activeItem.uid && (index < this.printList.length - 1)) {
              this.$store.commit('teachingMaterial/removeItem', this.activeItem)
              setTimeout(() => {
                this.activeItem.content = this.activeItem.backupContent || this.activeItem.content
                this.$store.commit('teachingMaterial/addItem', {item: this.activeItem, index: index + 1})
              }, 10)
            } else {
              console.log('bottom')
            }
          })
          break;
        default:
          console.log(type)
          break
      }
    }
  },
  computed: {
    remotePrint () {
      return this.$route.query.type === 'preview'
    },
    ...mapState({
      printList: (state) => {
        return state.teachingMaterial.printList
      },
      activeItem: (state) => {
        return state.teachingMaterial.activeItem
      },
      renderItem: (state) => {
        return state.teachingMaterial.renderItem
      },
      activeIndex: (state) => {
        return state.teachingMaterial.activeIndex
      }
    })
  },
}
</script>
```
```js
// operate-bar.vue
<template>
  <div contenteditable="false" class="sys-flex-column oprate-bar-component">
<!--    <i @click="btnClick('add')" class="iconfont icon-zengjiabeifen"></i>-->
    <i @click="btnClick('up')" class="iconfont icon-Moveup"></i>
    <i @click="btnClick('down')" class="iconfont icon-Movedown"></i>
    <i @click="btnClick('remove')" class="iconfont icon-shanchu"></i>
  </div>
</template>

<script>
export default {
  name: 'oprate-bar',
  methods: {
    btnClick (type) {
      this.$emit('click', type)
    }
  }
}
</script>
```
```js
// content-bar
<template>
  <div class="content-bar-component sys-flex-row sys-items-center">
    <i @click="undo" class="iconfont active icon-Previous"></i>
    <i @click="redo" class="iconfont icon-Nextstep"></i>
    <i class="iconfont active icon-proportion"></i>
    <i class="iconfont active icon-Suitable"></i>
    <div class="scal-select sys-flex-row sys-items-center">
      <i class="iconfont active icon-Less"></i>
<!--      <el-input class="scal-input" v-model="scal"></el-input>-->
      <span class="scal-input">{{scal}}%</span>
      <i class="iconfont active icon-add"></i>
    </div>
  </div>
</template>

<script>
export default {
  name: 'content-bar',
  data () {
    return {
      scal: 100
    }
  },
  methods: {
    undo () {
      document.execCommand('undo', false);
    },
    redo () {
      document.execCommand('redo', false);
    }
  }
}
</script>
```
# 4. image-bar
```js
<template>
  <div class="img-bar-components">
    <p class="component-title">图片</p>
    <p class="item-title">插入方式</p>
    <div class="insert-type-container sys-flex-row">
      <div @click="setPositon('static')" :class="{active: position === 'static', disabled: disabled}" class="insert-item sys-flex-column sys-flex-center">
        <i class="iconfont icon-qianruwenzi"></i>
        <span>嵌入文字</span>
      </div>
      <div @click="setPositon('absolute')" :class="{active: position !== 'static', disabled: disabled}" class="insert-item sys-flex-column sys-flex-center">
        <i class="iconfont icon-ziyouyidong"></i>
        <span>自由移动</span>
      </div>
    </div>
<!--    <div v-if="position !== 'static' && !disabled" class="icon-container sys-flex-row sys-flex-center">-->
<!--      <i @click="setFormat('bottom')" class="iconfont flex1 icon-bottom"></i>-->
<!--      <i @click="setFormat('top')" class="iconfont flex1 icon-top2"></i>-->
<!--      <i @click="setFormat('down')" class="iconfont flex1 icon-Movedown"></i>-->
<!--      <i @click="setFormat('up')" class="iconfont flex1 icon-Moveup"></i>-->
<!--    </div>-->
    <p class="item-title">图片编辑</p>
    <div class="prop-item sys-flex-row sys-items-center">
      <span class="prop-item-name">旋转</span>
      <el-slider @input="setStyle" class="flex1" :min="0" :max="360" v-model="rotate"></el-slider>
      <el-input class="img-bar-input" size="mini" @input="(val) => inputChange(val, 'rotate')" :value="rotate"></el-input>
    </div>
    <div class="prop-item sys-flex-row sys-items-center">
      <span class="prop-item-name">圆角</span>
      <el-slider @input="setStyle" class="flex1" :min="0" :max="500" v-model="borderRadius"></el-slider>
      <el-input class="img-bar-input" size="mini" @input="(val) => inputChange(val, 'borderRadius')" :value="borderRadius"></el-input>
    </div>
    <div class="prop-item sys-flex-row sys-items-center">
      <span class="prop-item-name">透明</span>
      <el-slider @input="setStyle" class="flex1" :min="0" :max="100" v-model="opacity"></el-slider>
      <el-input class="img-bar-input" size="mini" @input="(val) => inputChange(val, 'opacity')" :value="opacity"></el-input>
    </div>
    <br>
    <div class="prop-item sys-flex-row sys-items-center">
      <el-checkbox v-model="keepRate">保持长宽比</el-checkbox>
    </div>
    <br>
    <div class="prop-item sys-flex-row sys-items-center">
      <span class="prop-item-name">宽度</span>
      <el-slider @input="setStyle('width')" class="flex1" :min="0" :max="1000" v-model="width"></el-slider>
      <el-input class="img-bar-input" size="mini" @input="(val) => inputChange(val, 'width')" :value="width"></el-input>
    </div>
    <div class="prop-item sys-flex-row sys-items-center">
      <span class="prop-item-name">高度</span>
      <el-slider @input="setStyle('height')" class="flex1" :min="0" :max="1000" v-model="height"></el-slider>
      <el-input class="img-bar-input" size="mini" @input="(val) => inputChange(val, 'height')" :value="height"></el-input>
    </div>
  </div>
</template>

<script>
import {mapState} from 'vuex'
export default {
  name: 'img-bar',
  data () {
    return {
      rotate: 0,
      borderRadius: 0,
      opacity: 0,
      width: 0,
      height: 0,
      position: 'static',
      keepRate: true,
      imgRate: 0,
      changeType: ''
    }
  },
  methods: {
    inputChange (val, type) {
      this.changeType = type
      this[type] = parseInt(val) || 0
    },
    // setFormat () {},
    setStyle (type) {
      this.changeType = type
      this.activeImg.style.transform = `rotate(${this.rotate}deg)`
      this.activeImg.style.opacity = this.opacity ? `${(100 - this.opacity) / 100}` : ''
      this.activeImg.style.borderRadius = `${this.borderRadius}px`
      this.activeImg.style.width = this.width ? `${this.width}px` : ''
      this.activeImg.style.height = this.height ? `${this.height}px` : ''
      this.updateContent()
    },
    updateContent () {
      let dom = document.getElementById(this.activeItem.uid)
      if (dom) {
        let container = dom.getElementsByClassName('question-html-container')[0]
        this.$store.commit('teachingMaterial/updateItem', {
          ...this.activeItem,
          backupContent: container.innerHTML,
          height: container.clientHeight
        })
      }
    },
    setPositon (val) {
      // 页面背景不允许拖动
      if (this.disabled) return
      this.position = val
      if (val === 'absolute') {
        this.doMove(this.activeImg)
      } else {
        this.cancelMove(this.activeImg)
      }
      this.updateContent()
    },
    doMove (el) {
      el.style.position = 'absolute'
      el.style.zIndex = 999
      el.style.cursor = 'move'
      el.setAttribute('draggable', false)
      el.onmousedown = (dom) => {
        // 算出鼠标相对元素的位置
        let initLeft = el.offsetLeft
        let initTop = el.offsetTop
        let movStartLeft = dom.clientX
        let movStartTop = dom.clientY
        document.onmousemove = (e) => {
          // 用鼠标的位置减去鼠标相对元素的位置，得到元素的位置
          let left = (e.clientX - movStartLeft)
          let top = (e.clientY - movStartTop)
          let leftVal = initLeft + left
          let topVal = initTop + top
          let positionLeft = leftVal
          let positionTop = topVal
          el.style.left = positionLeft + 'px'
          el.style.top = positionTop + 'px'
        }
        // 当鼠标松开，且未触发onmouseup时
        document.onmouseup = () => {
          document.onmousemove = null
          document.onmouseup = null
          this.updateContent()
        }
      }
    },
    cancelMove (el) {
      el.style.position = 'static'
      el.style.zIndex = 0
      el.style.cursor = 'default'
      el.setAttribute('draggable', true)
      // 绑定拖拽
    },
    countAngle (transform) {
      let angle = 0
      if (transform !== 'none') {
        let values = transform.split('(')[1].split(')')[0].split(',');
        let a = values[0];
        let b = values[1];
        angle = Math.round(Math.atan2(b, a) * (180 / Math.PI));
      }
      return angle
    }
  },
  computed: {
    ...mapState({
      activeImg: (state) => {
        return state.teachingMaterial.activeImg
      },
      activeItem: (state) => {
        return state.teachingMaterial.activeItem
      }
    }),
    disabled () {
      return this.activeImg.className.indexOf('page-bg') > -1
    },
    imgStyle () {
      const { borderRadius, opacity, position } = window.getComputedStyle(this.activeImg)
      return { borderRadius: parseInt(borderRadius), opacity: (100 - parseInt(opacity * 100)), position}
    }
  },
  watch: {
    height (N) {
      if (this.keepRate && this.changeType === 'height') {
        this.width = parseInt(N * this.imgRate) || 0
      }
    },
    width (N) {
      if (this.keepRate && this.changeType === 'width') {
        this.height = parseInt(N / this.imgRate) || 0
      }
    },
    activeImg: {
      handler(N) {
        if (N) {
          let transform = window.getComputedStyle(N).transform
          if (!transform) return
          this.rotate = this.countAngle(transform)
          this.borderRadius = this.imgStyle.borderRadius
          this.opacity = this.imgStyle.opacity
          this.position = this.imgStyle.position
          this.height = N.clientHeight
          this.width = N.clientWidth
          this.imgRate = this.width / this.height
        }
      },
      immediate: true,
      deep: true
    }
  }
}
</script>
```
# 5. text-bar
```js
<template>
  <div class="text-bar-components">
    <p class="component-title">文字</p>
    <p class="item-title">字符</p>
    <div class="sys-flex-row">
      <el-dropdown>
        <el-button class="font-selecter" size="small">
          {{fontName && fontName !== 'none' ? fontName : '字体'}}<i class="el-icon-arrow-down el-icon--right"></i>
        </el-button>
        <el-dropdown-menu slot="dropdown">
          <el-dropdown-item class="font-select-item" v-for="item in fonts" :key="item.value">
            <el-button size="mini" class="item-btn" type="text" @click="setFormat('fontName', item.value)">{{item.label}}</el-button>
          </el-dropdown-item>
        </el-dropdown-menu>
      </el-dropdown>
      <el-dropdown>
        <el-button class="size-selecter" size="small">
          {{fontSize || '字号'}}<i class="el-icon-arrow-down el-icon--right"></i>
        </el-button>
        <el-dropdown-menu slot="dropdown">
          <el-dropdown-item class="size-select-item" v-for="item in sizes" :key="item.value">
            <el-button size="mini" class="item-btn" type="text" @click="setFormat('fontSize', item.value)">{{item.label}}</el-button>
          </el-dropdown-item>
        </el-dropdown-menu>
      </el-dropdown>
    </div>
    <div class="icon-container sys-flex-row sys-items-center">
      <i style="font-weight: normal" class="iconfont icon-beijingyanse"></i>
      <el-color-picker size="mini" v-model="hiliteColor" @change="(val) => setFormat('hiliteColor', val)"></el-color-picker>
      <span style="width: 10px"></span>
      <i style="font-weight: normal" class="iconfont icon-font-colors"></i>
      <el-color-picker size="mini" v-model="foreColor" @change="(val) => setFormat('foreColor', val)"></el-color-picker>
    </div>
    <p class="item-title">字符选项</p>
    <div class="icon-container sys-flex-row sys-flex-center">
      <i @click="setFormat('bold')" class="iconfont flex1 icon-bold"></i>
      <i @click="setFormat('italic')" class="iconfont flex1 icon-italic"></i>
      <i @click="setFormat('underline')" class="iconfont flex1 icon-under-line"></i>
      <i @click="setFormat('strikeThrough')" class="iconfont flex1 icon-delete-line1"></i>
    </div>
    <div class="icon-container sys-flex-row sys-flex-center">
      <i @click="setFormat('justifyLeft')" class="iconfont flex1 icon-leftalignment"></i>
      <i @click="setFormat('justifyCenter')" class="iconfont flex1 icon-centerralignment"></i>
      <i @click="setFormat('justifyRight')" class="iconfont flex1 icon-rightalignment"></i>
      <i @click="setFormat('justifyFull')" class="iconfont flex1 icon-zuoyouduiqi"></i>
    </div>
    <div class="icon-container sys-flex-row sys-flex-center">
      <i @click="setFormat('removeFormat')" class="iconfont flex1 icon-rubber"></i>
      <div class="flex3"></div>
    </div>
    <p class="item-title">段落</p>
    <div class="icon-container sys-flex-row sys-flex-center">
      <i @click="addText" class="flex1 iconfont icon-charukongge"></i>
      <el-dropdown>
        <el-button type="text" style="color: #000000; font-weight: bold" class="size-selecter">行高: {{lineHeight}}<i class="el-icon-arrow-down el-icon--right"></i>
        </el-button>
        <el-dropdown-menu slot="dropdown">
          <el-dropdown-item class="size-select-item" v-for="item in lineHeights" :key="item.value">
            <el-button size="mini" class="item-btn" type="text" @click="setLineHeight(item)">{{item.label}}</el-button>
          </el-dropdown-item>
        </el-dropdown-menu>
      </el-dropdown>
      <div class="flex3"></div>
    </div>
  </div>
</template>

<script>
import { mapState } from 'vuex'
export default {
  name: 'text-bar',
  data () {
    return {
      foreColor: '#ffffff',
      hiliteColor: '#000000',
      fontName: 'none',
      fontSize: 2,
      lineHeight: '默认',
      fonts: [{
        label: '默认',
        value: 'none'
      }, {
        label: '方正书宋',
        value: '方正书宋'
      }, {
        label: '方正楷体',
        value: '方正楷体'
      }, {
        label: '方正楷体拼音',
        value: '方正楷体拼音'
      }, {
        label: 'Times New Roman',
        value: 'Times New Roman'
      }, {
        label: '汉仪跳跳体',
        value: '汉仪跳跳体'
      }, {
        label: 'PINYINHEI-REGULAR',
        value: 'PINYINHEI-REGULAR'
      }, {
        label: 'PINYINHEI-BOLD',
        value: 'PINYINHEI-BOLD'
      }, {
        label: 'MyriadPro-Bold',
        value: 'MyriadPro-Bold'
      }, {
        label: 'STENCIL',
        value: 'STENCIL'
      }, {
        label: '方正榜书楷简体',
        value: '方正榜书楷简体'
      }, {
        label: '方正粗圆',
        value: '方正粗圆'
      }, {
        label: '方正粗圆简体',
        value: '方正粗圆简体'
      }, {
        label: '方正大黑',
        value: '方正大黑'
      }, {
        label: '方正黑体',
        value: '方正黑体'
      }, {
        label: '方正品尚中黑',
        value: '方正品尚中黑'
      }, {
        label: '方正少儿',
        value: '方正少儿'
      }, {
        label: '方正魏碑',
        value: '方正魏碑'
      }, {
        label: '方正准圆',
        value: '方正准圆'
      }, {
        label: '方正综艺',
        value: '方正综艺'
      }],
      lineHeights: [{
        label: '默认',
        value: 26
      }, {
        label: 12,
        value: 12
      }, {
        label: 14,
        value: 14
      }, {
        label: 16,
        value: 16
      }, {
        label: 18,
        value: 18
      }, {
        label: 20,
        value: 20
      }, {
        label: 24,
        value: 24
      }, {
        label: 28,
        value: 28
      }, {
        label: 32,
        value: 32
      }, {
        label: 36,
        value: 36
      }, {
        label: 40,
        value: 40
      }, {
        label: 44,
        value: 44
      }, {
        label: 46,
        value: 46
      }, {
        label: 48,
        value: 48
      }],
      sizes: [{
        label: 1,
        value: 1
      }, {
        label: 2,
        value: 2
      }, {
        label: 3,
        value: 3
      }, {
        label: 4,
        value: 4
      }, {
        label: 5,
        value: 5
      }, {
        label: 6,
        value: 6
      }, {
        label: 7,
        value: 7
      }],
      sizeMap: {
        '12px': 1,
        '13px': 2,
        '16px': 3,
        '18px': 4,
        '24px': 5,
        '48px': 7,
      }
    }
  },
  methods: {
    setFormat (type, val) {
      this[type] = val
      document.execCommand(type, true, val || 'rgba(0,0,0,0)');
    },
    setLineHeight (item) {
      this.lineHeight = item.label
      let focusNode = window.getSelection()
      const {parentElement} = focusNode.focusNode
      let question = parentElement.offsetParent.getElementsByClassName('question-html-container')[0]
      console.log(question.children)
      for (let i = 0; i < question.children.length; i++) {
        question.children[i].style.lineHeight = `${item.value}px`
      }
      // question.style.lineHeight = `${item.value}px`
      setTimeout(() => {
        this.$store.commit('teachingMaterial/updateItem', {
          ...this.activeItem,
          backupContent: question.innerHTML,
          height: question.clientHeight
        })
      })
    },
    addText () {
      let quesItem = {
        id: new Date().getTime(),
        uid: new Date().getTime(),
        content: '<div>在此输入内容...</div>',
        questionType: '文本框',
        height: 34,
        marks: []
      }
      if (this.activeIndex > 0 || this.activeIndex === 0) {
        this.$store.commit('teachingMaterial/addItem', {item: quesItem, index: this.activeIndex + 1})
      } else {
        this.$store.commit('teachingMaterial/addItem', {item: quesItem})
      }
    }
  },
  watch: {
    activeStyle: {
      handler (N) {
        this.foreColor = N.color
        this.hiliteColor = N.backgroundColor
        this.lineHeight = parseInt(N.lineHeight) || '默认'
        this.lineHeight = this.lineHeight === 19 ? '默认' : this.lineHeight
        this.fontName = N.fontFamily && N.fontFamily.split(',')[0]
        let keys = Object.keys(this.sizeMap)
        keys = keys.map(key => {
          return Math.abs(parseInt(key) / parseInt(N.fontSize) - 1)
        })
        let min = Math.min(...keys)
        let index = keys.indexOf(min)
        let mapKey = Object.keys(this.sizeMap)[index]
        this.fontSize = this.sizeMap[mapKey]
      },
      immediate: true,
      deep: true
    }
  },
  computed: {
    ...mapState({
      activeStyle: (state) => {
        return state.teachingMaterial.activeStyle
      },
      activeIndex: (state) => {
        return state.teachingMaterial.activeIndex
      },
      activeItem: (state) => {
        return state.teachingMaterial.activeItem
      }
    })
  }
}
</script>
```