---
title: axios配置
date: 2021-5-13
permalink:
categories:
  - 项目配置
tags:
  - 项目配置
---

## axios 的拦截配置

```js
export function axiosInit() {
  // 请求配置
  http.defaults.headers.post["Content-Type"] = "application/json";
  const token = getQueryVariable("token") || (me ? me.token : "");
  // 请求拦截
  http.requestInterceptor(
    (config) => {
      let parmasName = config._loading;
      if (parmasName) {
        store.commit("onLoading", { [parmasName]: parmasName });
      }
      if (token) {
        config.headers.Authorization = `Bearer ${token}`;
      }
      return config;
    },
    (err) => {
      return Promise.reject(err);
    }
  );
  // 拦截白名单
  const except = [
    "https://vod2.qcloud.com",
    "/service-question/exam/grade/template/download",
  ];
  // 添加响应拦截器
  http.responseInterceptor(
    function(response) {
      let loadName = response.config._loading;
      if (loadName) {
        setTimeout(() => {
          store.commit("onLoading", { [loadName]: false });
        }, 500);
      }
      let isExcept = except.some((item) => {
        return response.config.url.indexOf(item) !== -1;
      });
      if (response.data instanceof Blob) {
        return response.data;
      }
      if (isExcept) {
        return response;
      } else if (
        Number(response.code) === 0 ||
        Number(response.data.code) === 0
      ) {
        return response.data ? response.data : response;
      } else if (response.data.code === 401) {
        Message.error("登录信息失效，请重新登录！");
        accountLogout();
      } else if (Number(response.data.code) === 10001) {
        return response.data ? response.data : response;
      } else {
        return Promise.reject(response.data);
      }
    },
    function(error) {
      const err = error.response;
      let loadName = err && err.config._loading;
      if (loadName) {
        store.commit("onLoading", { [loadName]: false });
      }
      if (err) {
        switch (err.status) {
          case 401:
            Message({
              type: "error",
              message: "登录信息过期，请重新登录！",
              showClose: true,
            });
            setTimeout(accountLogout, 3000);
            break;
          case 403:
            Message({
              type: "error",
              message: "没有访问权限",
              showClose: true,
            });
            break;
          case 404:
            Message({
              type: "error",
              message: "资源不存在",
              showClose: true,
            });
            break;
          case 500:
            Message({
              type: "error",
              message: "网络错误",
              showClose: true,
            });
            break;
          case 504:
            Message({
              type: "error",
              message: "网关超时",
              showClose: true,
            });
            break;
          default:
            Message({
              type: "error",
              message: "网络错误",
              showClose: true,
            });
            break;
        }
      } else {
        // console.log(444, error, err)
        if (error.message === "abort") {
          // ajax abort,这里是在视频中心上传中主动中断请求的场景，所以不需要弹框。
          // src/pages/upload/uploader.vue:90
        } else {
          Message({
            type: "error",
            message: "未知错误，请联系管理员",
            showClose: true,
          });
        }
      }
      return Promise.reject(error);
    }
  );
  Vue.prototype.$http = http;
}
```

## 请求方式的配置

```js
/**
 * 封装get方法
 * @param url
 * @param params
 * @returns {Promise}
 */
export function get(api, params = {}) {
  return http.get(api, { params });
}

/**
 * 封装post请求
 * @param url
 * @param data
 * @returns {Promise}
 */
export function post(api, data = {}) {
  return http.post(api, data);
}

/**
 * 封装patch请求
 * @param url
 * @param data
 * @returns {Promise}
 */
export function patch(api, data = {}) {
  return http.patch(api, data);
}

export const download = (api, params, method) => {
  if (method === "get") {
    return http.get(api, {
      params,
      responseType: "blob",
    });
  }
  if (method === "post") {
    return http.post(api, {
      data: params,
      responseType: "blob",
    });
  }
};

/**
 * 封装put请求
 * @param url
 * @param data
 * @returns {Promise}
 */
export function put(api, data = {}) {
  return http.put(api, data);
}
```
