---
title: h5开发
date: 2020-05-13 
permalink: 
categories: 
  - H5
tags: 
  - null
---
```js
//vue.config.js
// vue.config.js
const VconsolePlugin = require('vconsole-webpack-plugin')
const VueSkeletonPlugin = require('vue-skeleton-webpack-plugin')
const CosPlugin = require('cos-webpack');
const path = require('path')
const mock = require('./mock');
const config = require('./config');
const util = require('./config/util')
// const skeletonConfig = require('./config/skeleton.config');

const isProd = ['production', 'prod'].includes(process.env.NODE_ENV)

function resolve(dir) {
  return path.join(__dirname, dir)
}
module.exports = {
  configureWebpack: (wpConfig) => {
    const {
      secretId, secretKey, enable, bucket, region, path
    } = config.cosConfig || {}
    const plugins = [];
    plugins.push(
      new VueSkeletonPlugin({
        webpackConfig: {
          entry: {
            app: resolve('skeleton/index.js')
          }
        },
        minimize: true,
        quiet: true,
        router: {
          mode: 'hash',
          routes: [
            {
              path: '/',
              skeletonId: 'skeleton'
            }
          ]
        }
      })
    )
    if (enable && process.env.NODE_ENV === 'production') {
      plugins.push(
        new CosPlugin({
          secretId,
          secretKey,
          bucket,
          region,
          path,
          exclude: /index\.html$/
        })
      )
    }
    wpConfig.plugins = [...wpConfig.plugins, ...plugins,
      new VconsolePlugin({
        // enable: true
        enable: !isProd
      })
    ];
  },
  chainWebpack: (config) => {
    if (process.env.NODE_ENV !== 'development') {
      config.plugin('html').tap((opts) => {
        if (opts && opts[0] && opts[0].minify) {
          opts[0].minify.removeComments = false
        }
        return opts
      })
    }
    // 解决修改.vue文件css时，不能及时热更新的问题
    config.resolve.symlinks(true)
  },
  css: {
    extract: process.env.NODE_ENV === 'production',
    loaderOptions: {
      postcss: {
        plugins: [
          // eslint-disable-next-line global-require
          require('postcss-px-to-viewport')({
            unitToConvert: 'px',
            viewportWidth: 375,
            viewportHeight: 667,
            unitPrecision: 6,
            propList: ['*'],
            viewportUnit: 'vw',
            fontViewportUnit: 'vw',
            selectorBlaskList: ['.vant-'],
            mediaQuery: false,
            minPixelValue: 2,
            replace: true,
            exclude: [],
            landscape: false,
            landscapeUnit: 'vw',
            landscapeWidth: 1134,
          }),
        ],
      },
      sass: {
        prependData: `
          @import "@/assets/styles/common.scss";
          @import "@/assets/styles/variable.scss";
        `,
      },
    },
  },
  publicPath: config.publicPath || '/',
  lintOnSave: true,
  pages: config.pages,
  outputDir: config.outputDir,
  devServer: {
    proxy: util.configProxy(config.proxy || {}),
    port: 8080,
    open: false,
    hot: true,
    overlay: {
      warnings: false,
      errors: true,
    },
    before(app) {
      Object.keys(mock).forEach((key) => {
        const mockValue = mock[key];
        const result = typeof mockValue === 'function'
          ? mockValue
          : (req, res) => res.json(mockValue);
        if (/^(POST)./g.test(key)) {
          app.post(key.replace('POST', '').trim(), result);
        } else {
          app.get(key.replace('GET', '').trim(), result);
        }
      });
    },
  },
};
```