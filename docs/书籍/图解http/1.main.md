---
title: 图解HTTP
date: 2021-06-15
permalink: 
categories: 
  - HTTP
tags: 
  - null
---
# 1 了解Web及网络基础
```js
-----1.2 HTTP诞生---
// 起初是为了共享文件，HTTP
Web服务器
HTTP/0.9
HTTP/1.0
HTTP/1.1
-----1.3 网络基础 TCP/IP----
// TCP/IP 协议族 ,HTTP属于它内部的一个子集
//TCP/IP 协议族 ,其中包含FTP HTTP IP UDP SNMP TCO ICMP DNS等
TCP/IP 的分层管理
应用层------>决定了向用户提供应用服务时通信的活动.---->HTTP 协议也处于该层。DNS 服务
传输层------>对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。---->TCP和UDP
网络层------>处理在网络上流动的数据包,`数据包`是网络传输的最小数据单位.----->规定通过的路径到达对方计算机，并把数据包传送给对方。(IP 协议)
数据链路层------>处理连接网络的硬件部分
TCP/IP 通信传输流
-----1.4 与 HTTP 关系密切的协议 : IP、TCP 和 DNS---
`IP 协议`:把各种数据包传送给对方
IP 地址 ：节点被分配到的地址
MAC 地址：指网卡所属的固定地址
IP 间的通信依赖 MAC 地址
ARP 是一种用以解析地址的协议，根据通信方 的 IP 地址就可以反查出对应的 MAC 地址
`TCP协议`：可靠的TCP协议，提供可靠的字节流服务
`报文段`
`三次握手` — SYN（synchronize）SYN/ACK 和 ACK（acknowledgement）。
`四次挥手` FIN ACK FIN ACK
------1.5 DNS服务--------
通过域名查找IP地址，或者通过IP地址反查域名的服务
------1.6 各种协议与HTTP协议的关系------
http协议:针对目标web服务器的HTTP请求报文
tcp协议:将http的请求报文分割，传送
ip协议：搜索对方的地址，一边中转一边传送
tcp协议：重组报文
http协议：将服务器请求的内容进行处理
------1.7 URI和URL------
URI 统一资源标识符， 用字符串标识某一互联网资源
URL 是URI的子集
有一些用来制定 HTTP 协议技术标准的文档，它们被称为 `RFC（Request for Comments，征求修正意见书）`
绝对URI: http://uer.pass@www.baidu.com/index.html?uid=1#ch1
相对URI:指的是资源在本地的位置。
```
# 2 简单的HTTP协议
```js
-----2.1 HTTP 协议用于客户端和服务器端之间 的通信----
请求报文是由请求方法(get post 等)、请求 URI、协议版本(HTTP/1.1)、可选的请求首部字段 和内容实体构成的。
响应报文基本上由协议版本、状态码（表示请求成功或失败的数字代 码）、用以解释状态码的原因短语、可选的响应首部字段以及实体主体构成。
-----2.3 HTTP是不保存状态的协议--------
但是引入cookie来管理状态
-----2.4 请求 URI 定位资源----
HTTP 协议使用 URI 定位互联网上的资源。正是因为 URI 的特定功 能，在互联网上任意位置的资源都能访问到。
-----2.5 告知服务器意图的 HTTP 方法-----
GET ：获取资源（请求访问已被 URI 识别的资源）
POST：传输实体主体（用来传输实体的主体）
PUT：传输文件 
HEAD：获得报文首部 （不返回报文主体部分。用于确认 URI 的有效性及资源更新的日期时间等)
DELETE：删除文件  
OPTIONS：查询针对请求 URI 指定的资源支持的方法
TRACE：追踪路径,让 Web 服务器端将之前的请求通信环回给客户端的方法 （Max-Forwards每经过一个服务器就会减1）
CONNECT：要求用隧道协议连接代理，主要使用 SSL TLS
LINK 建立和资源之间的联系 （http 1.0)
UNLINK 断开连接关系 （http 1.0)
-----2.6 使用方法下达命令----
 GET、POST 和 HEAD
-----2.7 持久连接节省通信量----
keep-alive HTTP/1.1
管线化：可以做到同时发送多个请求
-----2.8 使用 Cookie 的状态管理----
```
# 3 HTTP 报文内的 HTTP信息
```js
报文首部（通用首部、请求首部、响应首部和实体首部）、空行（CR+LF）、报文主体。
内容编码:gzip（GNU zip） compress（UNIX 系统的标准压缩） deflate（zlib） identity（不进行编码）
HTTP/1.1 中存在一种称为 `传输编码`（Transfer Coding）的机制，它可 以在通信时按某种编码方式传输，但只定义作用于分块传输编码中。
对象集合：
1. multipart/form-data  （Web 表单文件上传)
2. multipart/byteranges （状态码 206（Partial Content，部分内容）响应报文包含了多个范 围的内容时使用。）
-------------------------------------
获取部分内容的范围请求
指定范围发送的请 求叫做范围请求（Range Request）。
-------------------------------------
内容协商返回最合适的内容
内容协商机制是指客户端和服务器端就响应的资源内容进行交涉，然后提供给客户端最为适合的资源。
服务器驱动协商
客户端驱动协商
透明协商
```
# 4 返回结果的 HTTP状态码
```js
1XX Informational（信息性状态码） 接收的请求正在处理 
-------------------------------------------------
2XX Success（成功状态码） 请求正常处理完毕 
200 (OK) 
204 (No Content)
206 (Partial Content) 范围请求
-------------------------------------------------
3XX Redirection（重定向状态码） 需要进行附加操作以完成请求 
301 Moved Permanently（永久性重定向）
302 Found （该状态码表示请求的资源已被分配了新的 URI，希望 用户（本次）能使用新的 URI 访问。）
1）301 redirect——301代表永久性转移(Permanently Moved)，301重定向是网页更改地址后对搜索引擎友好的最好方法，只要不是暂时搬移的情况,都建议使用301来做转址。 如果我们把一个地址采用301跳转方式跳转的话，搜索引擎会把老地址的PageRank等信息带到新地址，同时在搜索引擎索引库中彻底废弃掉原先的老地址。旧网址的排名等完全清零
（2）302 redirect——302代表暂时性转移(Temporarily Moved )，在前些年，不少Black Hat SEO曾广泛应用这项技术作弊，目前，各大主要搜索引擎均加强了打击力度，象Google前些年对Business.com以及近来对BMW德国网站的惩罚。即使网站客观上不是spam，也很容易被搜寻引擎容易误判为spam而遭到惩罚。
303 See Other （该状态码表示由于请求对应的资源存在着另一个 URI，应使用 GET 方法定向获取请求的资源。）
304 Not Modified （资源已找到，但未符合条件请求）
307 Temporary Redirect（临时重定向）
-------------------------------------------------
4XX Client Error（客户端错误状态码） 服务器无法处理请求 
400 Bad Request
401 Unauthorized （需要带头部认证）
403 Forbidden （禁止访问）
404 Not Found （服务器上没有请求的资源）
-------------------------------------------------
5XX Server Error（服务器错误状态码） 服务器处理请求出错
500 Internal Server Error
503 Service Unavailable （服务器暂时处于超负载或正在进行停机维护，现在无法 处理请求）
```
# 5 与 HTTP 协作的 Web 服务器
```js
用单台虚拟主机实现多个域名。
代理：中间转换
1. 缓存代理
2. 透明代理
网关：转发其他服务器通信数据的服务器（提供非 HTTP 协议服务）
隧道：在相隔甚远的客户端和服务器两者之间进行中转，并保持双方 通信连接的应用程序。（SSL）
-------保存资源的缓存------
缓存的有效期限
客户端的缓存（临时网络文件）
```
# 6 HTTP 首部
```js
HTTP/1.1 通用首部字段
1. Cache-Control
缓存请求指令
no-cache 无 强制向源服务器再次验证 
no-store 无 不缓存请求或响应的任何内容 
max-age = [ 秒] 必需 响应的最大Age值 
max-stale( = [ 秒]) 可省略 接收已过期的响应 
min-fresh = [ 秒] 必需 期望在指定时间内的响应仍有效 
no-transform 无 代理不可更改媒体类型 
only-if-cached 无 从缓存获取资源 
cache-extension - 新指令标记（token）
缓存响应指令
public 无 可向任意方提供响应的缓存 
private 可省略 仅向特定用户返回响应 
no-cache 可省略 缓存前必须先确认其有效性 
no-store 无 不缓存请求或响应的任何内容 
no-transform 无 代理不可更改媒体类型 
must-revalidate 无 可缓存但必须再向源服务器进行确认 
proxy-revalidate 无 要求中间缓存服务器对缓存的响应有效性再 进行确认 
max-age = [ 秒] 必需 响应的最大Age值 
s-maxage = [ 秒] 必需 公共缓存服务器响应的最大Age值 
cache-extension - 新指令标记（token）
2. Connection
作用：控制不再转发给代理的首部字段、管理持久化连接
Connection: 不再转发的首部字段名
Connection: close （断开连接）
Connection: Keep-Alive
3. Date
4. Pragma
no-cache 不接收缓存
5. Trailer
6. Transfer-Encoding （传输报文主体时采用的编码方式，HTTP/1.1中进队分块传输编码有效）
7. Upgrade （用于检测 HTTP 协议及其他协议是否可使用更高的版本进行通信，其参数值可以用来指定一个完全不同的通信协议）
8. Via （为了追踪客户端与服务器之间的请求和响应报文 的传输路径。）
9. Warning （该首部通常会告知用户一些与缓存相关的问题的警告。）
Warning: [警告码][警告的主机:端口号]“[警告内容]”([日期时间])
----------------------请求首部字段--------------------
1. Accept 用户代理能够处理的媒体类型及媒体 类型的相对优先级
2. Accept-Charset 
3. Accept-Encoding
4. Accept-Language
5. Authorization
6. Expect
7. From 告知服务器使用用户代理的用户的电子邮件地址
8. Host
9. If-Match （条件请求，带有if），条件请求为真，才会执行请求。（Etag匹配一致）
10. Max-Forwards
11. Proxy-Authorization （代理认证请求）
12. Range (范围请求)
13. Referer （首部字段 Referer 会告知服务器请求的原始资源的 URI）
14. TE （告知服务器客户端能够处理响应的传输编码方式及相 对优先级）
15. User-Agent （用于传达浏览器的种类）
---------------------响应首部字段-----------------------
1. Accept-Ranges
2. Age （Age 能告知客户端，源服务器在多久前创建了响应）
3. ETag （ETag 能告知客户端实体标识）
4. Location （可以将响应接收方引导至某个与请求 URI 位置 不同的资源。）
5. Proxy-Authenticate 会把由代理服务器所要求的认证信息发送 给客户端。
6. Retry-After （告知客户端应该在多久之后再次发送请求。）
7. Server
8. Vary  (Vary 可对缓存进行控制。源服务器会向代理服务器传达关 于本地缓存使用方法的命令。)
9. WWW-Authenticate (用于HTTP访问认证，它会告知客户端 适用于访问请求 URI 所指定资源的认证方案)
---------------------实体首部字段----------------------
1. Allow （用于通知客户端能够支持 Request-URI 指定资源的所 有 HTTP 方法）
2. Content-Encoding
3. Content-Language
4. Content-Length
5. Content-Location
6. Content-MD5
7. Content-Range
8. Content-Type
9. Expires
10. Last-Modified
------------------为 Cookie 服务的首部字段-----------
set-cookie 
cookie
-----------------------------------------
X-Frame-Options 用于控制网站内容 在其他 Web 网站的 Frame 标签内的显示问题。
X-XSS-Protection
DNT  个人信息是否被收集
P3P  让 Web 网站上 的个人隐私变成一种仅供程序可理解的形式
``` 
# 7 确保 Web 安全的 HTTPS
```js
HTTP+ 加密 + 认证 + 完整性保护 =HTTPS
-------HTTPS 是身披 SSL 外壳的 HTTP-------
公开密钥加密  对称密钥加密
`使用两把密钥的公开密钥加密`
HTTPS 采用共享密钥加密和公开密钥加密两者并用的混合加密 机制。若密钥能够实现安全交换，那么有可能会考虑仅使用公开 密钥加密来通信。
---------认证----------------
--------安全通信机制---------
```
# 8 确认访问用户身份的认证
```js
HTTP/1.1 使用的认证方式如下所示。 
BASIC 认证（基本认证） 
DIGEST 认证（摘要认证） 
SSL 客户端认证 FormBase 认证（基于表单认证）
```
# 9 基于 HTTP 的功能追加 协议
```js
//HTTP/2.0 
1. 改善用户在使用web的速度体验
2. 多路复用
3. 压缩
//Web 服务器管理文件的 WebDAV
``
# 10 构建 Web 内容的技术
```js
1.HTML
4.数据发布的格式及语言
XML
发布更新信息的 RSS/Atom
JSON
```
# 11 Web 的攻击技术
```js
// web 站点来进行攻击
1. HTTP 不具备必要的安全功能
2. 在客户端即可篡改请求
3. 针对 Web 应用的攻击模式  （主动攻击和被动攻击）
主动攻击：SQL注入和OS命令注入攻击
// 因输出值转义不完全引发的安全漏洞
1. 跨站脚本攻击（xss）
2. SQL注入攻击
3. OS注入攻击 （Shell 来调用操作系统命令）
4. HTTP首部注入攻击
5. 邮件首部注入攻击
6. 目录遍历攻击
7. 远程文件包含漏洞
//因设置或设计上的缺陷引发的安全漏 洞
1. 强制浏览
2. 不正确的错误消息处理
3. 开放重定向
//会话引起的安全漏洞
1. 会话劫持
2. 会话固定攻击
3. 跨站点请求伪造（CSRF）
攻击是指攻击 者通过设置好的陷阱，强制对已完成认证的用户进行非预期的个人信 息或设定信息等某些状态更新.
// 其他攻击
1. 密码破解
2. 点击劫持
3. DoS 攻击
是一种让运行中的服务呈停止状 态的攻击。
4. 后门程序
后门程序（Backdoor）是指开发设置的隐藏入口，可不按正常步骤使 用受限功能。
```
